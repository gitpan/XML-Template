<html xmlns:core="http://syrme.net/xml-template/core/v1"
      xmlns:form="http://syrme.net/xml-template/form/v1"
      xmlns:file="http://syrme.net/xml-template/file/v1"
      xmlns:condition="http://syrme.net/xml-template/condition/v1"
      xmlns:var="http://syrme.net/xml-template/var/v1"
      xmlns:exception="http://syrme.net/xml-template/exception/v1"
      xmlns:block="http://syrme.net/xml-template/block/v1"
      xmlns:group="http://syrme.net/xml-template/group/v1"
      xmlns:item="http://syrme.net/xml-template/item/v1"
      xmlns:user="http://syrme.net/xml-template/user/v1"
      xmlns:multimedia="http://syrme.net/xml-template/multimedia/v1">

<body bgcolor="#ffffff" vlink="#005c20" link="#005c20"
      marginwidth="5" leftmargin="5" marginheight="0" topmargin="0">

<condition:if cond="${Form.op} eq 'listfiles'">
  <var:set name="uploadpath">${Config.namespaces.'${Form.xmlns}'.uploadpath}</var:set>
  <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
    <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
      <tr bgcolor="#005c20">
        <td>
          <font color="#ffffff">Files in '${uploadpath}'.</font>
        </td>
      </tr>
      <tr bgcolor="#cfe1c4">
        <td>
          <file:foreach var="file" src="${uploadpath}">
            ${file}<br/>
          </file:foreach>
        </td>
      </tr>
    </table>
  </td></tr></table>

<condition:else>

<file:include name="admin_header.xhtml"/>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="1">
      <img src="${Config.imagedir}/trans.gif" width="1" height="21" alt=" "/>
    </td>
    <var:foreach var="el" array="${Config.namespaces}">
      <condition:if cond="${Config.namespaces.'${el}'.sourcename}.defined">
        <condition:if cond="${el} eq ${Form.xmlns}">
          <td class="tab" width="109">
            <font size="-2">
              <a href="admin.xhtml?xmlns=${el}">${Config.namespaces.'${el}'.title}</a>
            </font>
          </td>
        <condition:else>
          <td class="tab_back" width="109">
            <font size="-2">
              <a href="admin.xhtml?xmlns=${el}">${Config.namespaces.'${el}'.title}</a>
            </font>
          </td>
        </condition:else>
        </condition:if>
      </condition:if>
    </var:foreach>
    <td class="box_bottom">&amp;nbsp;</td>
  </tr>
  <tr>
    <td colspan="7">
      <div class="box">

<condition:if cond="${Form.xmlns}.defined">
  <var:set name="key">${Config.namespaces.'${Form.xmlns}'.key}</var:set>
  <var:set name="prefix">${Config.namespaces.'${Form.xmlns}'.prefix}</var:set>

  <table width="100%" border="0" cellspacing="0" cellpadding="2">
    <tr>
      <td>
        <font size="-1">
        Help: [ <a href="help/toc.html"
                   onClick="window.open ('help/toc.html', 'help',
                              'toolbar=no,scrollbars=yes,width=320,height=320');
                            return false">Top</a>
              | <a href="help/${_modulename}\.html"
                   onClick="window.open ('help/${xmlns}\.html', 'help',
                              'toolbar=no,scrollbars=yes,width=320,height=320');
                            return false">${Config.namespaces.'${Form.xmlns}'.title}</a>
              ]
        </font>
      </td>
      <td align="right">
        <font size="-1">
        [ <a href="admin.xhtml?xmlns=${Form.xmlns}">New/Edit</a> |
          <a href="admin.xhtml?Logout=1">Logout</a> ]
        </font>
      </td>
    </tr>

    <condition:if cond="${Form.Upload}.defined">
      <var:set name="uploadpath">${Config.namespaces.'${Form.xmlns}'.uploadpath}</var:set>
      <exception:try>
        <form:upload name="file" dest="${uploadpath}/${Form.file}"/>

        <exception:catch>
          <block:include name="msgbox"
                         text="Error Uploading File '${Form.file}': ${Exception.info}"/>
        </exception:catch>
        <exception:else>
          <block:include name="msgbox"
                         text="Uploaded File '${Form.file}'."/>
        </exception:else>
      </exception:try>

    <condition:elseif cond="${Form.Update}.defined">
      <exception:try>
        <${prefix}:update name="${Form.old_${key}}" insert="yes">
          <${prefix}:foreach_describe fields="Field,Type,Values">
            <condition:if cond="${Type} eq 'datetime'">
              <${prefix}:${Field}>${Form.${Field}_year}-${Form.${Field}_month}-${Form.${Field}_day} ${Form.${Field}_hour}:${Form.${Field}_minute}:00</${prefix}:${Field}/>
            <condition:elseif cond="${Type} eq 'enum'">
              <condition:if cond="${Form.${Field}_new} ne ''">
                <${prefix}:alter action="change" column="${Field}" type="enum"
                                 values="${Values}.join (,),${Form.${Field}_new}"/>
                <${prefix}:${Field}>${Form.${Field}_new}</${prefix}:${Field}/>
              <condition:else>
                <${prefix}:${Field}>${Form.${Field}}</${prefix}:${Field}/>
              </condition:else>
              </condition:if>
            </condition:elseif>
            <condition:else>
              <${prefix}:${Field}>${Form.${Field}}</${prefix}:${Field}/>
            </condition:else>
            </condition:if>
          </${prefix}:foreach_describe>
        </${prefix}:update>

        <exception:catch>
          <block:include name="msgbox"
                         text="Error Creating/Updating ${Form.${key}}: ${Exception.info}"/>
        </exception:catch>
        <exception:else>
          <block:include name="msgbox"
                         text="Created/Updated ${Form.${key}}."/>
        </exception:else>
      </exception:try>
    </condition:elseif>

    <condition:elseif cond="${Form.Delete}.defined &amp;&amp; ! ${Form.Cancel}.defined">
      <condition:if cond="${Form.Confirm}.defined">
        <exception:try>
          <${prefix}:delete name="${Form.${key}}"/>

          <exception:catch>
            <block:include name="msgbox"
                           text="Error Deleting ${Form.${key}}: ${Exception.info}"/>
          </exception:catch>
          <exception:else>
            <block:include name="msgbox"
                           text="Deleted ${Form.${key}}."/>
          </exception:else>
        </exception:try>

      <condition:else>
        <tr>
          <td colspan="2">
            <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
              <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
                <form action="admin.xhtml" method="post">
                  <input type="hidden" name="xmlns" value="${Form.xmlns}"/>
                  <tr bgcolor="#005c20">
                    <td>
                      <a href="help/db.html#confirm"
                         onClick="window.open ('help/db.html#confirm',
                                               'help',
                                               'toolbar=no,scrollbars=yes,width=320,height=320');
                                  return false"><b><font color="white">Confirm Delete</font></b></a>
                    </td>
                  </tr>
                  <tr bgcolor="#cfe1c4">
                    <td>
                      Delete:
                      <ul>
                        <li><b>${Form.${key}}</b></li>
                      </ul>
                      <input type="hidden" name="Delete" value="Delete"/>
                      <input type="hidden" name="${key}" value="${Form.${key}}"/>
                      <input type="submit" name="Confirm" value="ConfirmDelete"/>
                      <input type="submit" name="Cancel" value="Cancel"/>
                    </td>
                  </tr>
                </form>
              </table>
            </td></tr></table>
          </td>
        </tr>
      </condition:else>
      </condition:if>
    </condition:elseif>

    <condition:elseif cond="${Form.AddMembers}.defined">
      <var:set name="related_prefix">${Config.namespaces.'${Form.related_xmlns}'.prefix}</var:set>
      <var:set name="related_keys">${Config.namespaces.'${Form.related_xmlns}'.key}</var:set>
      <${prefix}:select name="${Form.${key}}" fields="*">
        <exception:try>
          <var:foreach var="related_name" array="${Form.related_names}">
            <${related_prefix}:insert name="${related_name}"/>
          </var:foreach>

          <exception:catch>
            <block:include name="msgbox"
                           text="Error Adding Members: ${Exception.info}"/>
          </exception:catch>
          <exception:else>
            <block:include name="msgbox"
                           text="Added Members."/>
          </exception:else>
        </exception:try>
      </${prefix}:select>
    </condition:elseif>

    <condition:elseif cond="${Form.RemoveMembers}.defined">
      <var:set name="related_prefix">${Config.namespaces.'${Form.related_xmlns}'.prefix}</var:set>
      <var:set name="related_keys">${Config.namespaces.'${Form.related_xmlns}'.key}</var:set>
      <${prefix}:select name="${Form.${key}}" fields="*">
        <exception:try>
          <var:foreach var="member_name" array="${Form.member_names}">
            <${related_prefix}:delete name="${member_name}"/>
          </var:foreach>

          <exception:catch>
            <block:include name="msgbox"
                           text="Error Removing Members: ${Exception.info}"/>
          </exception:catch>
          <exception:else>
            <block:include name="msgbox"
                           text="Removed Members."/>
          </exception:else>
        </exception:try>
      </${prefix}:select>
    </condition:elseif>
    </condition:if>

    <tr>
      <td colspan="2">
        <condition:if cond="! ${Form.Edit}.defined">
          <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
            <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
              <form action="admin.xhtml" method="post">
                <input type="hidden" name="xmlns" value="${Form.xmlns}"/>
                <tr bgcolor="#005c20">
                  <td>
                    <font color="#ffffff">
                    <b>Select/Delete</b> [
                    <a href="help/db.html#select"
                       onClick="window.open ('help/db.html#select', 'help',
                                  'toolbar=no,scrollbars=yes,width=320,height=320');
                                return false"><font color="#ffffff">help</font></a>
                    ]
                    </font>
                  </td>
                </tr>
                <tr bgcolor="#cfe1c4">
                  <td>
                    <select name="${key}" size="10">
                      <${prefix}:foreach fields="${key}" orderby="${key}">
                        <option>${${key}}</option>
                      </${prefix}:foreach>
                    </select><br/>
                    <input type="submit" name="Edit" value="Edit"/>
                    <input type="submit" name="Delete" value="Delete"/>
                  </td>
                </tr>
              </form>
            </table>
          </td></tr></table>
        </condition:if>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
          <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
            <form action="admin.xhtml" method="post">
              <input type="hidden" name="xmlns" value="${Form.xmlns}"/>
              <input type="hidden" name="Edit" valie="Edit"/>
              <tr bgcolor="#005c20">
                <td colspan="2">
                  <font color="#ffffff">
                  <b>Create/Edit</b> [
                  <a href="help/db.html#edit"
                     onClick="window.open ('help/db.html#edit', 'help',
                                'toolbar=no,scrollbars=yes,width=320,height=320');
                              return false"><font color="#ffffff">help</font></a>
                  ]
                  </font>
                </td>
              </tr>
              <${prefix}:select name="${Form.${key}}" fields="*">
                <${prefix}:foreach_describe fields="Field,Type,Size,Key">
                  <tr>
                    <td width="1%" bgcolor="#f6eedf" align="right" nowrap="1">
                      <condition:if cond="${Key} eq 'PRI'">
                        <font color="red">*</font>
                      </condition:if>
                      <a href="help/${prefix}\.html#${Field}"
                         onClick="window.open('help/${prefix}\.html#${Field}', 'help',
                                    'toolbar=no,scrollbars=yes,width=320,height=320');
                                  return false">${Field}</a>:
                    </td>
                    <td bgcolor="#cfe1c4">
                      <condition:if cond="${Type} eq 'varchar'">
                        <condition:if cond="${Size} > 60">
                          <var:set name="size">60</var:set>
                        <condition:else>
                          <var:set name="size">${Size}</var:set>
                        </condition:else>
                        </condition:if>
                        <input type="text" name="${Field}" size="${size}" value="${${Field}}"/>
                      <condition:elseif cond="${Type} eq 'text'">
                        <textarea name="${Field}" rows="5" cols="40">${${Field}}</textarea>
                      </condition:elseif>
                      <condition:elseif cond="${Type} eq 'mediumtext'">
                        <textarea name="${Field}" rows="25" cols="60" wrap="off">${${Field}}</textarea>
                      </condition:elseif>
                      <condition:elseif cond="${Type} eq 'datetime'">
                        ${${Field}}.set_date_vars (${Field})
                        <form:select name="${Field}_month" default="${${Field}_month}">
                          <form:option value="01">January</form:option>
                          <form:option value="02">February</form:option>
                          <form:option value="03">March</form:option>
                          <form:option value="04">April</form:option>
                          <form:option value="05">May</form:option>
                          <form:option value="06">June</form:option>
                          <form:option value="07">July</form:option>
                          <form:option value="08">August</form:option>
                          <form:option value="09">September</form:option>
                          <form:option value="10">October</form:option>
                          <form:option value="11">November</form:option>
                          <form:option value="12">December</form:option>
                        </form:select>
                        <form:select name="${Field}_day" default="${${Field}_day}">
                          <var:foreach var="day" array="01..31">
                            <form:option value="${day}">${day}</form:option>
                          </var:foreach>
                        </form:select>,
                        <form:select name="${Field}_year" default="${${Field}_year}">
                          <var:foreach var="year" array="1998..2005">
                            <form:option value="${year}">${year}</form:option>
                          </var:foreach>
                        </form:select>@
                        <form:select name="${Field}_hour" default="${${Field}_hour}">
                          <var:foreach var="hour" array="00..24">
                            <form:option value="${hour">${hour}</form:option>
                          </var:foreach>
                        </form:select>:
                        <form:select name="${Field}_minute" default="${${Field}_minute}">
                          <var:foreach var="minute" array="00..60">
                            <form:option value="${minute}">${minute}</form:option>
                          </var:foreach>
                        </form:select>
                      </condition:elseif>
                      <condition:elseif cond="${Type} eq 'enum'">
                        <form:select name="${Field}" default="${${Field}}">
                          <var:foreach var="value" array="${Values}">
                            <form:option value="${value}">${value}</form:option>
                          </var:foreach>
                        </form:select>
                        <i>or</i> new value: 
                        <input type="text" name="${Field}_new" length="32"/>
                      </condition:elseif>
                      </condition:if>
                      <condition:if cond="${Key} eq 'PRI'">
                        <input type="hidden" name="old_${Field}" value="${${Field}}"/>
                      </condition:if>
                    </td>
                  </tr>
                </${prefix}:foreach_describe>
              </${prefix}:select>
              <tr bgcolor="#005c20">
                <td colspan="2" align="center">
                  <font color="#ffffff">
                    <input type="submit" name="Update" value="Update"/>
                  </font>
                </td>
              </tr>
            </form>
          </table>
        </td></tr></table>
      </td>
    </tr>

    <condition:if cond="! ${Form.Edit}.defined &amp;&amp;
                 ${Config.namespaces.'${Form.xmlns}'.uploadpath}.defined">
      <tr>
        <td colspan="2">
          <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
            <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
              <form action="admin.xhtml" method="post" enctype="multipart/form-data">
              <input type="hidden" name="xmlns" value="${Form.xmlns}"/>
              <tr bgcolor="#005c20">
                <td colspan="2">
                  <font color="#ffffff">
                  <b>Upload a File</b>
                  [
                  <a href="help/db.html#upload"
                     onClick="window.open ('help/db.html#upload', 'help',
                                'toolbar=no,scrollbars=yes,width=320,height=320');
                              return false"><font color="#ffffff">help</font></a>
                  ]
                  </font>
                </td>
              </tr>
              <tr bgcolor="#cfe1c4">
                <td bgcolor="#f7eedf" align="right" width="1">
                  Filename:
                </td>
                <td>
                  <input type="file" name="file" size="20"/>
                  <a href="admin.xhtml?op=listfiles&amp;xmlns=${Form.xmlns}"
                     onClick="window.open ('admin.xhtml?op=listfiles&amp;xmlns=${Form.xmlns}', 'files',
                                'toolbar=no,scrollbars=yes,width=320,height=320');
                              return false">List uploaded files</a>

                </td>
              </tr>
              <tr bgcolor="#005c20" align="center">
                <td colspan="2">
                  <font color="#ffffff">
                  <input type="submit" name="Upload" value="Uplod File"/>
                  </font>
                </td>
              </tr>
              </form>
            </table>
          </td></tr></table>
        </td>
      </tr>
    </condition:if>

    <condition:if cond="${Form.Edit}.defined">
      <condition:if cond="${Config.namespaces.'${Form.xmlns}'.relatedto}.defined">
        <var:foreach var="related_xmlns" array="${Config.namespaces.'${Form.xmlns}'.relatedto}">
          <var:set name="related_prefix">${Config.namespaces.'${related_xmlns}'.prefix}</var:set>
          <var:set name="related_keys">${Config.namespaces.'${related_xmlns}'.key}</var:set>
          <tr>
            <td colspan="2">
              <table width="100%" bgcolor="#666666" border="0" cellpadding="0" cellspacing="0"><tr><td>
                <table width="100%" bgcolor="#666666" border="0" cellpadding="1" cellspacing="1">
                  <form action="admin.xhtml" method="post">
                  <input type="hidden" name="xmlns" value="${Form.xmlns}"/>
                  <input type="hidden" name="related_xmlns" value="${related_xmlns}"/>
                  <input type="hidden" name="Edit" valie="Edit"/>
                  <input type="hidden" name="${key}" value="${Form.${key}}"/>
                  <tr bgcolor="#005c20">
                    <td colspan="2">
                      <font color="#ffffff">
                      <b>Add/Remove ${related_prefix} Members</b>
                      [
                      <a href="help/db.html#related"
                         onClick="window.open ('help/db.html#related', 'help',
                                    'toolbar=no,scrollbars=yes,width=320,height=320');
                                  return false"><font color="#ffffff">help</font></a>
                      ]
                      </font>
                    </td>
                  </tr>
                  <tr>
                    <td bgcolor="#f6eedf" colspan="2">
                      <table width="100%" border="0" cellpadding="1" cellspacing="0">
                        <tr>
                          <td width="33%">
                            Members:<br/>
                            <select name="member_names" size="10" multiple="yes">
                              <${prefix}:select name="${Form.${key}}" fields="*">
                                <${related_prefix}:foreach fields="*">
                                  <option>${${related_keys}}</option>
                                </${related_prefix}:foreach>
                              </${prefix:select}>
                            </select>
                          </td>
                          <td align="center" valign="center" width="33%">
                            <input type="submit" name="AddMembers" value=" &lt; "/><br/><br/>
                            <input type="submit" name="RemoveMembers" value=" &gt; "/>
                          </td>
                          <td width="33%">
                            Non-Members:<br/>
                            <select name="related_names" size="10" multiple="yes">
                              <${related_prefix}:foreach fields="*">
                                <option>${${related_keys}}</option>
                              </${related_prefix}:foreach:foreach>
                            </select>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                  </form>
                </table>
              </td></tr></table>
            </td>
          </tr>
        </var:foreach>
      </condition:if>
    </condition:if>

  </table>

<condition:else>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td><b>Select a module.</b></td>
      <td align="right">[ <a href="admin.xhtml?Logout=1">Logout</a> ]</td>
    </tr>
  </table>
</condition:else>
</condition:if>

      </div>
    </td>
  </tr>
</table>

</condition:else>
</condition:if>

</body>

</html>
